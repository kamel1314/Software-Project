<!DOCTYPE html>
<html>
<head>
  <title>Select Role</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>üéì Welcome to Campus Events</h1>
  <p>Select your role:</p>

  <button onclick="setRole('student')">I'm a Student</button>
  <button onclick="showAdminLogin()">I'm an Admin</button>

  <!-- Hidden admin login section -->
  <div id="admin-login" style="display: none; margin-top: 20px;">
    <h3>üîí Admin Login</h3>
    <input type="password" id="adminId" placeholder="Enter Admin ID" />
    <button onclick="verifyAdmin()">Login</button>
    <p id="loginError" style="color: red;"></p>
  </div>

  <script>
    const API_URL = "http://localhost:3001";

    // Student role
    function setRole(role) {
      localStorage.setItem("role", role);
      window.location.href = "index.html";
    }

    // Show Admin login box
    function showAdminLogin() {
      document.getElementById("admin-login").style.display = "block";
    }

    // Verify Admin ID against database
    async function verifyAdmin() {
      const adminId = document.getElementById("adminId").value.trim();
      const errorMsg = document.getElementById("loginError");
      const loginBtn = document.querySelector("#admin-login button");

      if (!adminId) {
        errorMsg.innerText = "‚ùå Please enter an Admin ID.";
        return;
      }

      // Disable button and show loading
      loginBtn.disabled = true;
      loginBtn.innerText = "Verifying...";
      errorMsg.innerText = "";

      try {
        const response = await fetch(API_URL + "/auth/verify-admin", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ adminId })
        });

        const data = await response.json();

        if (response.ok && data.valid) {
          localStorage.setItem("role", "admin");
          localStorage.setItem("adminId", adminId);
          localStorage.setItem("adminName", data.name);
          alert("‚úÖ Welcome, " + data.name + "!");
          window.location.href = "index.html";
        } else {
          errorMsg.innerText = data.error || "‚ùå Unknown user ‚Äî access denied.";
          loginBtn.disabled = false;
          loginBtn.innerText = "Login";
        }
      } catch (error) {
        console.error("Error verifying admin:", error);
        errorMsg.innerText = "‚ùå Connection error. Please check the server is running.";
        loginBtn.disabled = false;
        loginBtn.innerText = "Login";
      }
    }
  </script>
</body>
</html>
